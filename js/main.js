let produtos = [
    {
        id: 1,
        name: "Abobrinha Especial",
        price: 89.00,
        desc: "Abobrinha, Calabresa e Queijo Parmesão",
        inCart: 0
    },
    {
        id: 2,
        name: "Alcachofra",
        price: 92.00,
        desc: "Alcachofra, Champignon e Mussarela",
        inCart: 0
    },
    {
        id: 3,
        name: "Aliche",
        price: 92.00,
        desc: "Anchovas Importadas",
        inCart: 0
    },
    {
        id: 4,
        name: "Bacalhau",
        price: 109.00,
        desc: "Bacalhau, Cebola, Ovos e Pimentão",
        inCart: 0
    },
    {
        id: 5,
        name: "Camarão I",
        price: 124.00,
        desc: "Camarão, Mussarela e Cebola",
        inCart: 0
    },
    {
        id: 6,
        name: "Camarão II",
        price: 129.00,
        desc: "Camarão, Catupiry e Champignon",
        inCart: 0
    },
    {
        id: 7,
        name: "Carne Seca I",
        price: 89.00,
        desc: "Mussarela, Carne Seca e Cebola",
        inCart: 0
    },
    {
        id: 8,
        name: "Carne Seca II",
        price: 94.00,
        desc: "Catupiry, Carne Seca e Cebola",
        inCart: 0
    },
    {
        id: 9,
        name: "Filé Mignon I",
        price: 109.00,
        desc: "Filé Mignon com Musssarela",
        inCart: 0
    },
    {
        id: 10,
        name: "Filé Mignon II",
        price: 114.00,
        desc: "Filé Mignon com Catupiry",
        inCart: 0
    },
    {
        id: 11,
        name: "Abobrinha I",
        price: 79.00,
        desc: "Abobrinha, coberta com Mussarela",
        inCart: 0
    },
    {
        id: 12,
        name: "Abobrinha II",
        price: 84.00,
        desc: "AAbobrinha, coberta com Catupiry",
        inCart: 0
    },
    {
        id: 13,
        name: "Atum",
        price: 85.00,
        desc: "Atum sólido e Cebola",
        inCart: 0
    },
    {
        id: 14,
        name: "Bacon",
        price: 79.00,
        desc: "Mussarela e Bacon",
        inCart: 0
    },
    {
        id: 15,
        name: "Baiana",
        price: 71.00,
        desc: "Calabresa moída com cebola e ovos",
        inCart: 0
    },
    {
        id: 16,
        name: "Bárbara",
        price: 89.00,
        desc: "Calabresa fatiada com Mussarela e Champignon",
        inCart: 0
    },
    {
        id: 17,
        name: "Berinjela",
        price: 79.00,
        desc: "Berinjela, coberta com Mussarela",
        inCart: 0
    },
    {
        id: 18,
        name: "Brócolis I",
        price: 79.00,
        desc: "Brócolis, coberto com Mussarela",
        inCart: 0
    },
    {
        id: 19,
        name: "Brócolis II",
        price: 84.00,
        desc: "Brócolis, coberto com Catupiry",
        inCart: 0
    },
    {
        id: 20,
        name: "Calabresa I",
        price: 71.00,
        desc: "Calabresa com Cebola",
        inCart: 0
    },
    {
        id: 21,
        name: "Calabresa II",
        price: 79.00,
        desc: "Calabresa com Mussarela e Cebola",
        inCart: 0
    },
    {
        id: 22,
        name: "Calabresa III",
        price: 84.00,
        desc: "Calabresa com Catupiry",
        inCart: 0
    },
    {
        id: 23,
        name: "Carioca",
        price: 77.00,
        desc: "Calabresa moída, Mussarela e Cebola",
        inCart: 0
    },
    {
        id: 24,
        name: "Calzone Mão na Roda I",
        price: 91.00,
        desc: "Presunto, Catupiry, Bacon e Ovos cozidos",
        inCart: 0
    },
    {
        id: 25,
        name: "Calzone Mão na Roda II",
        price: 94.00,
        desc: "Presunto, Catupiry, Bacon e Ovos fritos",
        inCart: 0
    },
    {
        id: 26,
        name: "Calzone do Chef",
        price: 96.00,
        desc: "Atum, Tomate picado, Cebola e toque de Limão",
        inCart: 0
    },
    {
        id: 27,
        name: "Cinco Queijos",
        price: 98.00,
        desc: "Mussarela, Gorgonzola, Provolone, Catupiry e Parmesão",
        inCart: 0
    },
    {
        id: 28,
        name: "Dois Queijos",
        price: 81.00,
        desc: "Mussarela e Catupiry",
        inCart: 0
    },
    {
        id: 29,
        name: "Escarola I",
        price: 84.00,
        desc: "Escarola, coberta com Catupiry",
        inCart: 0
    },
    {
        id: 30,
        name: "Escarola II",
        price: 95.00,
        desc: "Escarola com Mussarela e Aliche importado",
        inCart: 0
    },
    {
        id: 31,
        name: "Escarola III",
        price: 81.00,
        desc: "Escarola com Mussarela e Bacon",
        inCart: 0
    },
    {
        id: 32,
        name: "Florença",
        price: 83.00,
        desc: "Mussarela, Creme de Alho, Tomate picado, Bacon e Salsa",
        inCart: 0
    },
    {
        id: 33,
        name: "Frango I",
        price: 81.00,
        desc: "Frango, desfiado com Mussarela",
        inCart: 0
    },
    {
        id: 34,
        name: "Frango II",
        price: 86.00,
        desc: "Frango, desfiado com Catupiry",
        inCart: 0
    },
    {
        id: 35,
        name: "Grega",
        price: 86.00,
        desc: "Presunto, Palmito e Ervilha, coberto com Mussarela",
        inCart: 0
    },
    {
        id: 36,
        name: "Lombo I",
        price: 81.00,
        desc: "Lombo, fatiado com Mussarela",
        inCart: 0
    },
    {
        id: 37,
        name: "Lombo II",
        price: 86.00,
        desc: "Lombo, fatiado com Catupiry",
        inCart: 0
    },
    {
        id: 38,
        name: "Lombo Especial",
        price: 94.00,
        desc: "Lombo, Palmito, Catupiry e Bacon",
        inCart: 0
    },
    {
        id: 39,
        name: "Mão na Roda I",
        price: 86.00,
        desc: "Presunto, Cebola, Ovos, Mussarela e Bacon",
        inCart: 0
    },
    {
        id: 40,
        name: "Mão na Roda II",
        price: 89.00,
        desc: "Presunto, Catupiry, Bacon e Ovos",
        inCart: 0
    },
    {
        id: 41,
        name: "Marrguerita",
        price: 81.00,
        desc: "Mussarela, Manjericão, Parmesão e Alho salpicado",
        inCart: 0
    },
    {
        id: 42,
        name: "Milão",
        price: 79.00,
        desc: "Abobrinha, Azeite e Parmesão",
        inCart: 0
    },
    {
        id: 43,
        name: "Milho I",
        price: 79.00,
        desc: "Milho, coberto com Mussarela",
        inCart: 0
    },
    {
        id: 44,
        name: "Milho II",
        price: 83.00,
        desc: "Milho, coberto com Catupiry",
        inCart: 0
    },
    {
        id: 45,
        name: "Moda da Casa",
        price: 87.00,
        desc: "Calabresa, Catupiry e Bacon",
        inCart: 0
    },
    {
        id: 46,
        name: "Mussarela",
        price: 71.00,
        desc: "Mussarela derretida",
        inCart: 0
    },
    {
        id: 47,
        name: "Napolitana",
        price: 81.00,
        desc: "Mussarela, Parmesão ralado e Tomate fatiado",
        inCart: 0
    },
    {
        id: 48,
        name: "Palmito I",
        price: 86.00,
        desc: "Mussarela e Palmito picado",
        inCart: 0
    },
    {
        id: 49,
        name: "Palmito II",
        price: 90.00,
        desc: "Palmito picado com Catupiry e Bacon",
        inCart: 0
    },
    {
        id: 50,
        name: "Peito de Peru I",
        price: 91.00,
        desc: "Peito de Peru, Champignon e Palmito coberto com Mussarela",
        inCart: 0
    },
    {
        id: 51,
        name: "Peito de Peru II",
        price: 95.00,
        desc: "Peito de Peru, Champignon, Palmito com Catupiry",
        inCart: 0
    },
    {
        id: 52,
        name: "Peperoni I",
        price: 81.00,
        desc: "Peperoni com Mussarela",
        inCart: 0
    },
    {
        id: 53,
        name: "Peperoni II",
        price: 84.00,
        desc: "Peperoni com Catupiry",
        inCart: 0
    },
    {
        id: 54,
        name: "Peruana I",
        price: 89.00,
        desc: "Atum com Mussarela",
        inCart: 0
    },
    {
        id: 55,
        name: "Peruana II",
        price: 94.00,
        desc: "Atum com Catupiry e Cebola",
        inCart: 0
    },
    {
        id: 56,
        name: "Pizza de Chef",
        price: 89.00,
        desc: "Atum, Tomate picado, Cebola e toque de Limão",
        inCart: 0
    },
    {
        id: 57,
        name: "Pizza Paulista I",
        price: 89.00,
        desc: "Berinjela, coberta com Mussarela com borda de Catupiry",
        inCart: 0
    },
    {
        id: 58,
        name: "Pizza Paulista II",
        price: 94.00,
        desc: "Berinjela, coberta com Catupiry com borda de Catupiry",
        inCart: 0
    },
    {
        id: 59,
        name: "Portuguesa I",
        price: 75.00,
        desc: "Presunto, Ovos e Cebola",
        inCart: 0
    },
    {
        id: 60,
        name: "Portuguesa II",
        price: 82.00,
        desc: "Mussarela, Presunto, Ovos e Cebola",
        inCart: 0
    },
    {
        id: 61,
        name: "Portuguesa III",
        price: 75.00,
        desc: "Presunto, Ovos, Cebola e Catupiry",
        inCart: 0
    },
    {
        id: 62,
        name: "Quatro Queijos",
        price: 91.00,
        desc: "Mussarela, Gorgonzona, Provolone e Catupiry",
        inCart: 0
    },
    {
        id: 63,
        name: "Roma",
        price: 81.00,
        desc: "Mussarela, molho Pesto de Rúcula e Tomate Cereja",
        inCart: 0
    },
    {
        id: 64,
        name: "Romana",
        price: 95.00,
        desc: "Mussarela, Aliche importado e Parmesão",
        inCart: 0
    },
    {
        id: 65,
        name: "Rúcula I",
        price: 84.00,
        desc: "Mussarela, Rúcula e Tomate seco",
        inCart: 0
    },
    {
        id: 66,
        name: "Rúcula II",
        price: 89.00,
        desc: "Mussarela de Búfala, Rúcula e Tomate seco",
        inCart: 0
    },
    {
        id: 67,
        name: "Siciliana",
        price: 82.00,
        desc: "Mussarela, Champignon e Bacon",
        inCart: 0
    },
    {
        id: 68,
        name: "Toscana",
        price: 75.00,
        desc: "Calabresa moída, rodelas de Tomate e Parmesão",
        inCart: 0
    },
    {
        id: 69,
        name: "Três Queijos",
        price: 87.00,
        desc: "Mussarela, Provolone e Catupiry",
        inCart: 0
    },
    {
        id: 70,
        name: "Turin",
        price: 91.00,
        desc: "Catupiry, Provolone, Parmesão, Alho e rodelas de Tomate",
        inCart: 0
    },
    {
        id: 71,
        name: "Veneza I",
        price: 101.00,
        desc: "borda de Catupiry, Frango, Palmito, Milho, coberta com Mussarela",
        inCart: 0
    },
    {
        id: 72,
        name: "Veneza II",
        price: 105.00,
        desc: "borda de Catupiry, Frango, Palmito, Milho, coberta com Catupiry",
        inCart: 0
    },
    {
        id: 73,
        name: "Vetura",
        price: 90.00,
        desc: "Lombo, Palmito, Mussarela e Cebola",
        inCart: 0
    },
    {
        id: 74,
        name: "Banana",
        price: 64.00,
        desc: "Banana com Leite Condensado e Canela",
        inCart: 0
    },
    {
        id: 75,
        name: "Brigadeiro com Morango",
        price: 81.00,
        desc: "Brigadeiro com Leite Condensado e Morango",
        inCart: 0
    },
    {
        id: 76,
        name: "Chocolate",
        price: 71.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 77,
        name: "Chocolate com Banana",
        price: 74.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 78,
        name: "Chocolate com Confete",
        price: 75.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 79,
        name: "Chocolate com Sorvete",
        price: 85.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 80,
        name: "Chocolate com Granulado",
        price: 74.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 81,
        name: "Chocolate com Morango",
        price: 81.00,
        desc: "sChocolate com Leite Condensado e Morango",
        inCart: 0
    },
    {
        id: 82,
        name: "Sorvete com Banana",
        price: 80.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 83,
        name: "Romeu e Julieta",
        price: 81.00,
        desc: "Queijo com Goiabada",
        inCart: 0
    },
    {
        id: 84,
        name: "Calabresa Acebolada",
        price: 51.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 85,
        name: "Frango à Passarinho",
        price: 57.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 86,
        name: "Pão de Alho Especial",
        price: 27.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 87,
        name: "Filé Mignon Aperitivo",
        price: 81.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 88,
        name: "Fritas",
        price: 29.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 89,
        name: "Salada Mista",
        price: 39.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 90,
        name: "Petit Gateau",
        price: 29.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 91,
        name: "Pudim",
        price: 15.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 92,
        name: "Torta Holandesa",
        price: 18.00,
        desc: "sem descrição",
        inCart: 0
    },
    {
        id: 93,
        name: "Lasanha à Bolonhesa",
        price: 41.00,
        desc: "Serve uma Pessoa (300g)",
        inCart: 0
    },
    {
        id: 94,
        name: "Espaguete",
        price: 41.00,
        desc: "Serve uma Pessoa. Escolha o Molho no Fim da compra",
        inCart: 0
    },
    {
        id: 95,
        name: "Nhoque",
        price: 41.00,
        desc: "Escolha o Molho no Fim da compra",
        inCart: 0
    },
    {
        id: 96,
        name: "Raviole Verde com Mussarela de Búfala",
        price: 47.00,
        desc: "Serve uma Pessoa (300g). Escolha o Molho no Fim da compra",
        inCart: 0
    },
    {
        id: 97,
        name: "Coca-Cola",
        price: 7.20,
        desc: "Latinha",
        inCart: 0
    },
    {
        id: 98,
        name: "Guaraná Antartica",
        price: 7.20,
        desc: "Latinha",
        inCart: 0
    },
    {
        id: 99,
        name: "Fanta Uva",
        price: 7.20,
        desc: "Latinha",
        inCart: 0
    },
    {
        id: 100,
        name: "Fanta Laranja",
        price: 7.20,
        desc: "Latinha",
        inCart: 0
    },
    {
        id: 101,
        name: "Schweppes Citrus",
        price: 8.50,
        desc: "Latinha",
        inCart: 0
    },
    {
        id: 102,
        name: "Guaraná",
        price: 16.00,
        desc: "Garrafa de 2L",
        inCart: 0
    },
    {
        id: 103,
        name: "Guaraná Zero",
        price: 16.00,
        desc: "Garrafa de 2L",
        inCart: 0
    },
    {
        id: 104,
        name: "Coca-Cola Zero",
        price: 16.00,
        desc: "Garrafa de 2L",
        inCart: 0
    }
]

let carts = document.querySelectorAll('.ad-carrinho');

for (let i=0; i < carts.length; i++){
    carts[i].addEventListener('click' , () => {
        cartNumbers(produtos[i]);
        precoTotal(produtos[i]);
    })
}

function onLoadCartNumber(){
    let productNumbers = localStorage.getItem('cartNumbers');
    if(productNumbers){
        document.querySelector('.carrinho span').textContent = productNumbers;
    }
}

function cartNumbers(produto){
    let productNumbers = localStorage.getItem('cartNumbers');
    productNumbers = parseInt(productNumbers);

    if(productNumbers) {
        localStorage.setItem('cartNumbers', productNumbers + 1);
        document.querySelector('.carrinho span').textContent = productNumbers + 1;
    } else{
        localStorage.setItem('cartNumbers' , 1);
        document.querySelector('.carrinho span').textContent = 1;
    }

    setItens(produto);
}

function setItens(produto){
    let cartItens = localStorage.getItem('produtosNoCarrinho');

    cartItens = JSON.parse(cartItens);

    if (cartItens != null) {

        if(cartItens[produto.id] == undefined){
            cartItens = {
                ...cartItens,
                [produto.id] : produto
            }
        } 

        cartItens[produto.id].inCart += 1;
    } else {
        produto.inCart = 1;

        cartItens = {
            [produto.id]: produto
        };
    }

    localStorage.setItem("produtosNoCarrinho", JSON.stringify(cartItens));
}

function precoTotal(produto){
    let cartTotal = localStorage.getItem("Total");

    if(cartTotal != null){
        cartTotal = parseInt(cartTotal);
        localStorage.setItem("Total", cartTotal + produto.price);
    }else{
        localStorage.setItem("Total" , produto.price);
    }
}

function precoTotalMenos(produto){
    let cartTotal = localStorage.getItem("Total");
    cartTotal = parseInt(cartTotal);
    localStorage.setItem("Total", cartTotal - produto.price);
}

function precoTotalMenos2(produto){
    let cartTotal = localStorage.getItem("Total");
    cartTotal = parseInt(cartTotal);
    localStorage.setItem("Total", cartTotal - produto.price * produto.inCart);
}

function cartNumbersMenos(produto){
    let productNumbers = localStorage.getItem('cartNumbers');
    productNumbers = parseInt(productNumbers);
    localStorage.setItem('cartNumbers', productNumbers - 1);
    document.querySelector('.carrinho span').textContent = productNumbers - 1;
    setItensMenos(produto);
}

function cartNumbersMenos2(produto){
    let productNumbers = localStorage.getItem('cartNumbers');
    productNumbers = parseInt(productNumbers);
    localStorage.setItem('cartNumbers', productNumbers - produto.inCart);
    document.querySelector('.carrinho span').textContent = productNumbers - produto.inCart;
    setItensMenos(produto);
}

function tirarCarrinho(produto){
    let cartItens = localStorage.getItem('produtosNoCarrinho');
    cartItens = JSON.parse(cartItens);
    delete cartItens[produto.id];
    localStorage.setItem("produtosNoCarrinho" , JSON.stringify(cartItens));
}

function setItensMenos(produto){
    let cartItens = localStorage.getItem('produtosNoCarrinho');

    cartItens = JSON.parse(cartItens);

    cartItens[produto.id].inCart -= 1;

    localStorage.setItem("produtosNoCarrinho", JSON.stringify(cartItens));
}

function displayCart(){
    let cartItens = localStorage.getItem("produtosNoCarrinho");
    cartItens = JSON.parse(cartItens);
    let produtoCarrinho = document.querySelector(".produtos-carrinho");
    let totalCarrinho = document.querySelector(".val_total")
    let cartTotal = localStorage.getItem("Total");

    if (cartItens && produtoCarrinho){
        produtoCarrinho.innerHTML = '';
        Object.values(cartItens).map(item => {
            produtoCarrinho.innerHTML += `
            <div class="container">
                <div class="row">
                    <div class="col-2 mt-2"><img src="./imagens/talher.png" width="30" alt="talheres"></div>
                    <div class="col-3 mt-2"><h3>${item.name}</h3></div>
                    <div class="col-3 mt-2 quantidade">
                        <h4>
                            <ion-icon class="botao" name="remove-circle" onclick="retiraItem(${item.id})"></ion-icon>
                            <span id="quantidadeItem">${item.inCart}</span>
                            <ion-icon class="botao" name="add-circle" onclick="adicionaItem(${item.id})"></ion-icon>
                        </h4>
                    </div>
                    <div class="col-3 mt-2 preco"><h4>R$ ${item.price}</h4></div>
                    <div class="col-1 mt-2"><a href="" onclick="lixeira(${item.id})"><img src="./imagens/lixeira.png" width="25" alt="excluir"></a></div>
                </div>
            </div>
            `
        });
        totalCarrinho.innerHTML += `
            <div>
                <h3>R$ ${cartTotal}</h3>
            </div>
        ` 
    }
}

function adicionaItem(itemID){
    let cartItens = localStorage.getItem('produtosNoCarrinho');
    cartItens = JSON.parse(cartItens);
    localStorage.setItem("produtosNoCarrinho", JSON.stringify(cartItens));
    precoTotal(cartItens[itemID]);
    cartNumbers(cartItens[itemID]);
    location.reload();
}

function retiraItem(itemID){
    let cartItens = localStorage.getItem('produtosNoCarrinho');
    cartItens = JSON.parse(cartItens);
    precoTotalMenos(cartItens[itemID]);
    cartNumbersMenos(cartItens[itemID]);
    verifica(cartItens[itemID]);
    location.reload();
}

function verifica(produto){
    let cartItens = localStorage.getItem('produtosNoCarrinho');
    cartItens = JSON.parse(cartItens);
    if (cartItens[produto.id].inCart == 0){
        let cartItens = localStorage.getItem('produtosNoCarrinho');
        cartItens = JSON.parse(cartItens);
        delete cartItens[produto.id];
        localStorage.setItem("produtosNoCarrinho" , JSON.stringify(cartItens));
    }
}

function limpar(produto){
    let cartItens = localStorage.getItem('produtosNoCarrinho');
    cartItens = JSON.parse(cartItens);
    cartItens[produto.id].inCart -= cartItens[produto.id].inCart;
    localStorage.setItem("produtosNoCarrinho", JSON.stringify(cartItens));
}

function lixeira(itemID){
    let cartItens = localStorage.getItem('produtosNoCarrinho');
    cartItens = JSON.parse(cartItens);
    precoTotalMenos2(cartItens[itemID]);
    cartNumbersMenos2(cartItens[itemID]);
    limpar(cartItens[itemID]);
    tirarCarrinho(cartItens[itemID]);
    location.reload()
}

//definição da função para enviar o pedido
function enviarPedido(){
    //feito
    let obsInput = document.querySelector("#observacao");
    let obsUsuario = "sem observações";
    if (obsUsuario != null){
        obsUsuario = obsInput.value;
    }

    let pagInput = document.querySelectorAll('input[name="form-pag"]');
    let pagaSelec = "a"
    let findSelected = () => {
        let selected = document.querySelector('input[name="form-pag"]:checked').value;
        if (selected == "debito"){
            pagaSelec = "cartão de débito";
            console.log("op1")
        } else if (selected == "credito"){
            pagaSelec = "cartão de crédito";
            console.log("op2")
        } else{
            pagaSelec = "PIX";
            console.log("op3")
        }
    }
    pagInput.forEach(pag => {
        pag.addEventListener("change" , findSelected);
    })
    findSelected();

    var nomeQuant = [];
    let cartItens = localStorage.getItem('produtosNoCarrinho');
    cartItens = JSON.parse(cartItens);
    let cartItensKeys = Object.keys(cartItens);
    for (i=0; i < cartItensKeys.length; i++){
        let nomeProd = cartItens[cartItensKeys[i]].name;
        let quant = cartItens[cartItensKeys[i]].inCart;
        let quantNom = " "+ quant + " " + nomeProd;
        nomeQuant.push(quantNom);
    }

    nomeQuant = nomeQuant.toString();
    window.location.href = `https://wa.me/551124215066?text=Olá, gostaria de fazer um pedido. Os produtos que selecionei foram:${nomeQuant}. Minha(s) observação(ões) é(são): ${obsUsuario}. A forma de pagamento que escolhi é ${pagaSelec}.`;
    
    obsInput.value = "";
}


onLoadCartNumber();
displayCart();